<!DOCTYPE html>

<html data-role="guest" lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>GIT BPol ‚Äì Ganzheitliche Innovation &amp; Transformation</title>
<style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#334155; --text:#e5e7eb;
      --accent:#22d3ee; --accent-2:#a78bfa; --danger:#ef4444; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1224,#0f172a);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

    /* === App Shell / Layout === */
    .app{max-width:1600px;margin:auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap}
    .title{font-size:clamp(20px,2.8vw,32px);font-weight:800}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    button,.btn{border:0;border-radius:14px;padding:10px 14px;background:var(--muted);color:var(--text);cursor:pointer;box-shadow:var(--shadow);transition:transform .06s ease,filter .2s ease}
    button:hover{filter:brightness(1.07)} button:active{transform:translateY(1px)}
    .btn-accent{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1020;font-weight:700}
    .btn-danger{background:linear-gradient(135deg,#f87171,var(--danger))}

    .card{background:rgba(255,255,255,.04);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius)}
    .card.pad{padding:16px}

    .layout{display:grid;grid-template-columns:3fr 1fr;gap:16px}
    @media (max-width:1200px){.layout{grid-template-columns:1fr}}

    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    .grid-4{grid-template-columns:repeat(4,1fr)}
    @media (max-width:1100px){.grid-4{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.grid-3,.grid-2,.grid-4{grid-template-columns:1fr}}

    .muted-text{opacity:.8;font-size:13px}
    .eyebrow{font-size:12px;letter-spacing:.3px;opacity:.9}
    .h1{font-size:clamp(22px,3.2vw,36px);font-weight:900}
    .h2{font-size:clamp(18px,2.4vw,26px);font-weight:800;margin:0 0 8px}

    /* === Top Gov bar (Logo + Title + Clock) === */
    .govbar{
      position: sticky; top: 0; z-index: 500;
      display: flex; align-items: center; gap: 12px;
      padding: 10px 16px;
      background: linear-gradient(180deg, rgba(11,16,32,.85), rgba(15,23,42,.85));
      border-bottom: 1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(6px);
      justify-content: space-between;
    }
    .govbar .left{display:flex;align-items:center;gap:12px}
    .govbar .gov-logo{display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:6px;background:#000;overflow:hidden;box-shadow:0 4px 14px rgba(0,0,0,.4)}
    .govbar .gov-logo img{width:100%;height:100%;object-fit:contain}
    .govbar .gov-title{font-size:clamp(16px,2vw,22px);font-weight:700;letter-spacing:.2px;color:#e5e7eb;text-shadow:0 1px 0 rgba(0,0,0,.4)}
    .gov-right{display:flex;align-items:center;gap:14px;margin-left:auto}
    .clock-pill{font-variant-numeric:tabular-nums;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#e5e7eb;box-shadow:0 4px 14px rgba(0,0,0,.25) inset;min-width:72px;text-align:center}

    /* === Hero === */
    .hero{display:grid;gap:14px;padding:20px}
    .hero .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .pill{padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12)}

    /* === Metrics === */
    .metric{padding:16px;border-radius:16px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03)}
    .metric .label{font-size:12px;opacity:.8;margin-bottom:6px}
    .metric .value{font-size:24px;font-weight:800}

    /* === Progress Bar === */
    .progress{height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
    .progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .6s ease}

    /* === Lists / Items === */
    .list{padding:16px}
    .item{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);margin-bottom:8px}
    .dot{width:10px;height:10px;border-radius:50%}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.07);font-size:11px;white-space:nowrap}

    /* === Timeline === */
    .timeline{padding:16px}
    .milestone{position:relative;padding:10px 10px 10px 14px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);border-radius:12px;margin-bottom:8px}
    .milestone::before{content:"";position:absolute;left:0;top:0;bottom:0;width:4px;background:linear-gradient(180deg,var(--accent),var(--accent-2));border-radius:12px 0 0 12px}

    /* === Sections === */
    section[id]{scroll-margin-top:72px}
    .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .search{min-width:240px}

    /* === Footer === */
    footer{opacity:.7;text-align:center;font-size:12px;padding:10px}
  
/* === Pretty Login Dialog (scoped, adjusted) === */
#loginDialog::backdrop{ background: rgba(2,6,23,.55); backdrop-filter: blur(2px); }
#loginDialog{ border-radius: var(--radius); border:1px solid rgba(255,255,255,.10); background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); box-shadow: var(--shadow); color:#fff; font-size:15px; }
#loginDialog .dlg-head{ display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08); }
#loginDialog .dlg-title{ font-weight:800; letter-spacing:.2px; font-size:18px; color:#fff; }
#loginDialog .dlg-body{ padding:20px; display:grid; gap:14px; }
#loginDialog .field{ display:grid; gap:8px; }
#loginDialog label span{ font-size:14px; font-weight:600; color:#fff; }
#loginDialog input{ width:100%; padding:12px 38px 12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
  background: rgba(0,0,0,.35); color: #fff; outline: none; font-size:15px; }
#loginDialog input:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.18); }
#loginDialog .pwd-wrap{ position:relative; }
#loginDialog .togglePwd{ position:absolute; right:8px; top:50%; transform:translateY(-50%);
  border:0; background:transparent; color:#fff; opacity:.85; cursor:pointer; font-size:16px; padding:0 4px; line-height:1; height:auto; }
#loginDialog .dlg-actions{ display:flex; justify-content:flex-end; gap:10px; padding:12px 20px 20px; }
#loginDialog .hint{ font-size:12px; opacity:.8; color:#fff; }
#loginDialog .brand{ display:flex; align-items:center; gap:8px; font-size:13px; opacity:.9; color:#fff; }
#loginDialog .brand .dot{ width:8px;height:8px;border-radius:50%; background: var(--accent); }

  /* notify z-index */
  .toast, .notify { z-index: 99999 !important; }

  /* Role-gating */
  [data-roles]{ display:none !important; }
  html[data-role="guest"]  [data-roles~="guest"]  { display:inline-flex !important; }
  html[data-role="admin"]  [data-roles~="admin"]  { display:inline-flex !important; }
  html[data-role="dirza2"] [data-roles~="dirza2"] { display:inline-flex !important; }
  html[data-role="dirza3"] [data-roles~="dirza3"] { display:inline-flex !important; }
  /* /Role-gating */

  /* === Vollbild Lade-Overlay mit Kreis === */
  #loginOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    backdrop-filter: blur(2px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 99999;
  }
  #loginOverlay .spinner {
    width: 64px; height: 64px;
    border: 6px solid rgba(255,255,255,.3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
<script src="./auth.js"></script>
</head>
<body>
<!-- Vollbild Login Overlay -->
<div id="loginOverlay"><div class="spinner" aria-label="L√§dt‚Ä¶"></div></div>

<!-- Government bar -->
<div class="govbar">
<div class="left">
<span class="gov-logo"><img alt="Bundespolizei Wappen" src="assets/Federal_Police_Patch.svg.png"/></span>
<span class="gov-title">Bundespolizeipr√§sidium Nord K√∂ln</span>
</div>
<div class="gov-right"><span class="clock-pill" id="clock">--:--</span></div>
</div>
<div class="app">
<header>
<div class="title">üöÄ GIT Projekt ‚Äì Ganzheitliches Innovations &amp; Transformations Projekt</div>
<span class="clock-pill" id="roleIndicator">Gast</span>
</header>
<!-- Hero -->
<section class="hero card pad">
<div class="h1">Webanwendungen des Bundespolizeipr√§sidium Nord K√∂ln</div>
<div class="row">
</div>
<div class="row">
<!--<a class="btn" data-roles="guest admin dirza2 dirza3" href="">üìÇ Personalakten (Gesperrt)</a> -->
<a class="btn" data-roles="admin dirza2 dirza3" href="DirZA2- Kalender.html">üì∞ DirZA 2 Kalender</a>
<a class="btn" data-roles="admin dirza2 dirza3" href="https://nicthebaddev.github.io/Bundespolizeipr-sidium-Nord-K-ln-Dir-ZA-DocFiller">üìÇ DirZA 2 DocFiller</a>
<a class="btn" data-roles="admin dirza2 dirza3" href="">üì∞ DirZA 3 Kalender (Nicht Online)</a>
<!--<a class="btn" data-roles="guest admin dirza2 dirza3" href="#faq">‚ùì FAQ</a> -->
<button class="btn-accent" data-roles="guest admin dirza2 dirza3" id="loginBtn" onclick="(function(){var d=document.getElementById('loginDialog'); if(!d)return; if(d.showModal) d.showModal(); else d.setAttribute('open', '');})();">üîê Login</button>
</div>
</section>
<br/>
<!-- Main split: News + Right rail -->
<aside class="grid">
<section class="card list" id="kontakt">
<div class="h2">üë§ Ansprechpartner</div>
<div class="item">
<div class="dot" style="background:var(--accent)"></div>
<div>
<div style="font-weight:700">Programmleitung</div>
<div class="muted-text">Nic Winter ‚Ä¢ <a href="mailto:nic.wintert@bundespolizei.de">nic.winter@bundespolizei.de</a></div>
</div>
</div>
</div>
</section>
</aside>
</div>
<footer>¬© 2025-2030 Bundespolizei ‚Äì Programm GIT BPol</footer>
    <p class="muted-text" style="text-align:center">Rechtlicher Hinweis / Disclaimer</p>
    <p class="muted-text" style="text-align:center">Die auf dieser Website sowie im digitalen Kalender dargestellten Inhalte dienen ausschlie√ülich der Nutzung im Rahmen des GTA V / FiveM Roleplay (RP).
Alle dargestellten Daten, Termine, Bezeichnungen und Ereignisse sind fiktiv und haben keinen Bezug zu realen Personen, Beh√∂rden, Institutionen oder tats√§chlichen Vorg√§ngen.
Jegliche √Ñhnlichkeiten mit real existierenden Namen, Einrichtungen oder Ereignissen sind rein zuf√§llig und nicht beabsichtigt.</p>
    <p class="muted-text" style="text-align:center">Alle eingegeben daten werden unverschl√ºsselt in einer Google Sheetstabelle abgelegt.</p>
  </div>
<!-- Login-Dialog -->
<dialog class="card" id="loginDialog" style="padding:0;max-width:min(420px,92vw)">
<div class="dlg-head">
<div class="brand"><span class="dot"></span><span class="dlg-title">Anmelden</span></div>
<button aria-label="Schlie√üen" class="btn" id="closeLogin" type="button">‚úï</button>
</div>
<form class="dlg-body" id="loginForm">
<div class="field">
<label><span>Benutzername</span>
<input autocomplete="username" name="username" required=""/>
</label>
</div>
<div class="field pwd-wrap">
<label><span>Passwort</span>
<input autocomplete="current-password" name="password" required="" type="password"/>
</label>
<button aria-label="Passwort anzeigen" class="togglePwd" type="button">üëÅÔ∏è</button>
</div>
<div class="hint">Nur berechtigte Nutzer (admin, dirza2, dirza3). Missbrauch wird protokolliert.</div>
<div class="dlg-actions">
<button class="btn" id="cancelLogin" type="button">Abbrechen</button>
<button class="btn-accent">Einloggen</button>
</div>
</form>
</dialog>
<script>
    // === Clock HH:MM (24h)
    const clockEl = document.getElementById('clock');
    function updateClock(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      if (clockEl) clockEl.textContent = `${hh}:${mm}`;
    }
    updateClock();
    setInterval(updateClock, 1000);
    // Load auth.js dynamically (won't break page if missing)
    let Auth = null;
    (async () => {
      try {
        /* global auth.js used; session will be called below */
      } catch (e) {
        console.warn('auth.js (global) wird erwartet ‚Äì wenn fehlt, bleibt Gast-Modus', e);
      }
    })();


    
    // === Role helper (non-destructive: only sets dataset.role, you can use CSS if needed)
    function setRole(role){
      document.documentElement.dataset.role = role || 'guest';
    }
    (function initSession(){
      if (window.Auth && typeof window.Auth.session === 'function'){
        window.Auth.session().then(s => setRole(s.role||'guest')).catch(()=>setRole('guest'));
      } else {
        setRole('guest');
      }
    })();

    // === Demo data (can be replaced with backend later) ===
    const NEWS = [
      {date:'2025-08-01', title:'Start Handlungsfeld ‚ÄûProzesse‚Äú ‚Äì E2E-Workshops', tag:'Prozesse', color:'#34d399', text:'Kick-off und Mapping der Kernprozesse. Teilnahme der Abteilungen DirE, DirZ, ZIT.'},
      {date:'2025-07-15', title:'Pilot ‚ÄûE-Akte mobil‚Äú erfolgreich', tag:'Digitalisierung', color:'#22d3ee', text:'Erste Einsatzgruppen testen die mobile E-Akte. Feedback flie√üt in den Rolloutplan Q4/2025.'},
      {date:'2025-07-01', title:'Programm GIT BPol offiziell gestartet', tag:'Programm', color:'#a78bfa', text:'Vorstellung in der Hausleitungssitzung und Ver√∂ffentlichung des Programmleitfadens.'}
    ];

    const MILESTONES = [
      {date:'2025-09-30', name:'Blueprint Organisationsstruktur V1', tag:'Organisation'},
      {date:'2025-10-15', name:'E-Akte ‚Äì Rollout-Welle 1', tag:'Digitalisierung'},
      {date:'2025-11-30', name:'Schulungsprogramm ‚ÄûDigital Basics‚Äú live', tag:'Personal & Qualifizierung'},
      {date:'2026-01-31', name:'SLA f√ºr priorisierte Kernprozesse', tag:'Prozesse'}
    ];

    const DOCS = [
      {name:'Programmleitfaden (PDF)', href:'#', tag:'Leitfaden'},
      {name:'Roadmap 2025‚Äì2027 (PPTX)', href:'#', tag:'Roadmap'},
      {name:'Template Ma√ünahmensteckbrief (DOCX)', href:'#', tag:'Vorlage'},
      {name:'Kommunikationspaket (ZIP)', href:'#', tag:'Kommunikation'}
    ];

    // === Render helpers ===
    const $ = (s)=>document.querySelector(s);

    function renderProgress(){
      document.querySelectorAll('.progress > span[data-progress]')
        .forEach(el=>{ const p = Math.max(0, Math.min(100, Number(el.dataset.progress)||0)); el.style.width = p + '%'; });
    }

    function renderNews(list){
      const box = $('#newsList');
      if (!box) return;
      box.innerHTML = '';
      list.sort((a,b)=> (b.date+a.title).localeCompare(a.date+b.title));
      list.forEach(n=>{
        const row = document.createElement('div');
        row.className = 'item';
        row.innerHTML = `
          <div class="dot" style="background:${n.color}"></div>
          <div style="flex:1">
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <strong>${n.title}</strong>
              <span class="badge">${n.tag}</span>
            </div>
            <div class="muted-text">${new Date(n.date+'T00:00').toLocaleDateString('de-DE',{weekday:'short',day:'2-digit',month:'2-digit',year:'numeric'})}</div>
            <div class="muted-text">${n.text}</div>
          </div>`;
        box.appendChild(row);
      });
    }

    function renderMilestones(){
      const box = $('#milestones');
      if (!box) return;
      box.innerHTML = '';
      MILESTONES
        .sort((a,b)=> a.date.localeCompare(b.date))
        .forEach(m=>{
          const el = document.createElement('div');
          el.className = 'milestone';
          el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
            <div><strong>${m.name}</strong> <span class="badge">${m.tag}</span></div>
            <div class="muted-text">${new Date(m.date+'T00:00').toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'})}</div>
          </div>`;
          box.appendChild(el);
        });
    }

    function renderDocs(list){
      const box = $('#docList');
      if (!box) return;
      box.innerHTML = '';
      list.forEach(d=>{
        const row = document.createElement('div'); row.className = 'item';
        row.innerHTML = `
          <div class="dot" style="background:#64748b"></div>
          <div style="flex:1">
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <a href="${d.href}"><strong>${d.name}</strong></a>
              <span class="badge">${d.tag}</span>
            </div>
          </div>
          <div><button class="btn" title="Kopieren" data-copy="${d.name}">üìã</button></div>`;
        row.querySelector('button[data-copy]')?.addEventListener('click', (e)=>{
          const t = e.currentTarget.getAttribute('data-copy');
          navigator.clipboard?.writeText(t);
          notify('Titel kopiert');
        });
        box.appendChild(row);
      });
    }

    // Simple notify
    function notify(msg){
      const n=document.createElement('div'); n.textContent=msg;
      n.style.cssText='position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:99999';
      document.body.appendChild(n); setTimeout(()=>n.remove(),1800);
    }

    // Filters
    const newsSearchEl = $('#newsSearch');
    if (newsSearchEl) {
      newsSearchEl.addEventListener('input', (e)=>{
        const q = e.target.value.trim().toLowerCase();
        const filtered = !q ? NEWS : NEWS.filter(x=> (x.title+x.text+x.tag).toLowerCase().includes(q));
        renderNews(filtered);
      });
    }
    const docSearchEl = $('#docSearch');
    if (docSearchEl) {
      docSearchEl.addEventListener('input', (e)=>{
        const q = e.target.value.trim().toLowerCase();
        const filtered = !q ? DOCS : DOCS.filter(x=> (x.name+x.tag).toLowerCase().includes(q));
        renderDocs(filtered);
      });
    }

    // Login dialog
    const loginDialog = document.getElementById('loginDialog');
    document.getElementById('loginBtn')?.addEventListener('click', ()=> loginDialog.showModal());
    document.getElementById('closeLogin').addEventListener('click', ()=> loginDialog.close());
    document.getElementById('cancelLogin').addEventListener('click', ()=> loginDialog.close());
    // Toggle password visibility
    const tp = document.querySelector('#loginDialog .togglePwd');
    const pwd = document.querySelector('#loginDialog input[name="password"]');
    tp?.addEventListener('click', ()=>{
      if (!pwd) return;
      const isPwd = pwd.type === 'password';
      pwd.type = isPwd ? 'text' : 'password';
      tp.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
    });

    // === Login mit Overlay-Spinner ===
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const f = e.target;
      const username = f.username.value.trim();
      const password = f.password.value;
      const overlay = document.getElementById('loginOverlay');

      // Dialog sofort schlie√üen und Overlay zeigen
      loginDialog.close();
      if (overlay) overlay.style.display = 'flex';

      try {
        if (!window.Auth || typeof window.Auth.login !== 'function') throw new Error('auth.js nicht geladen');
        const info = await window.Auth.login(username, password);
        document.documentElement.dataset.role = info.role || 'guest';
        notify(`Willkommen ${info.username} (${info.role})`);
      } catch (err) {
        notify('Login fehlgeschlagen: ' + (err && err.message ? err.message : ''));
      }

      if (overlay) overlay.style.display = 'none';
      f.reset();
    });

    // Initial render
    renderProgress();
    renderNews(NEWS);
    renderMilestones();
    renderDocs(DOCS);

    // Show total progress text next to bar
    const total = document.querySelector('#progTotal');
    const totalBar = document.querySelector('.metric .progress > span[data-progress]');
    if(total && totalBar){ total.textContent = (totalBar.dataset.progress||'0') + ' %'; }
  </script>

<script>
// Ensure notify toasts appear above dialog even if existing CSS is overridden
(function(){
  const Z = 20000;
  const origNotify = window.notify;
  window.notify = function(msg){
    if (typeof origNotify === 'function') {
      const before = document.querySelectorAll('.toast,.notify').length;
      origNotify(msg);
      // after a tick, bump z-index for created nodes
      setTimeout(()=>{
        document.querySelectorAll('.toast,.notify').forEach(el=>{
          el.style.zIndex = Z;
          el.style.position = el.style.position || 'fixed';
        });
      }, 0);
      return;
    }
    // Fallback simple notifier
    const n = document.createElement('div');
    n.className = 'notify';
    n.textContent = msg;
    n.style.cssText = 'position:fixed;left:50%;top:18px;transform:translateX(-50%);'
      +'background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.12);'
      +'padding:10px 14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.35);'
      +'z-index:'+Z;
    document.body.appendChild(n);
    setTimeout(()=>n.remove(), 2400);
  };
})();

function setRole(role){
  const r = role || 'guest';
  document.documentElement.dataset.role = r;
  const ri = document.getElementById('roleIndicator');
  if (ri) {
    let label = 'Gast';
    if (r === 'admin') label = 'Admin';
    if (r === 'dirza2') label = 'DirZA 2';
    if (r === 'dirza3') label = 'DirZA 3';
    ri.textContent = label;
  }
}

</script>
</body>
</html>
